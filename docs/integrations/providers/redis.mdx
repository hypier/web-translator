# Redis

>[Redis (远程字典服务器)](https://en.wikipedia.org/wiki/Redis) 是一个开源的内存存储，用作分布式的内存键值数据库、缓存和消息代理，具有可选的持久性。由于它将所有数据保存在内存中，并且由于其设计，`Redis` 提供了低延迟的读写，使其特别适合需要缓存的用例。Redis 是最流行的 NoSQL 数据库，也是最受欢迎的数据库之一。

本页面介绍了如何在 LangChain 中使用 [Redis](https://redis.com) 生态系统。内容分为两个部分：安装和设置，以及对特定 Redis 封装的引用。

## 安装与设置

安装 Python SDK：

```bash
pip install redis
```

要在本地运行 Redis，您可以使用 Docker：

```bash
docker run --name langchain-redis -d -p 6379:6379 redis redis-server --save 60 1 --loglevel warning
```

要停止容器：

```bash
docker stop langchain-redis
```

并再次启动它：

```bash
docker start langchain-redis
```

### 连接

我们需要一个 Redis URL 连接字符串，以连接到数据库，支持独立的 Redis 服务器或具有复制和 Redis Sentinel 的高可用性设置。

#### Redis 独立连接 URL
对于独立的 `Redis` 服务器，可以使用官方 Redis 连接 URL 格式，如 Python Redis 模块中描述的 "from_url()" 方法 [Redis.from_url](https://redis-py.readthedocs.io/en/stable/connections.html#redis.Redis.from_url)

示例: `redis_url = "redis://:secret-pass@localhost:6379/0"`

#### Redis Sentinel 连接 URL

对于 [Redis Sentinel 设置](https://redis.io/docs/management/sentinel/)，连接方案为 "redis+sentinel"。这是对官方 IANA 注册协议方案的非官方扩展，因为目前没有可用于 Sentinels 的连接 URL。

示例: `redis_url = "redis+sentinel://:secret-pass@sentinel-host:26379/mymaster/0"`

格式为 `redis+sentinel://[[username]:[password]]@[host-or-ip]:[port]/[service-name]/[db-number]`，如果未明确设置，默认值为 "service-name = mymaster" 和 "db-number = 0"。
service-name 是在 Sentinel 中配置的 Redis 服务器监控组名称。

当前的 URL 格式将连接字符串限制为仅一个 sentinel 主机（不能给出列表），并且 Redis 服务器和 sentinel 必须设置相同的密码（如果使用）。

#### Redis 集群连接 URL

目前，Redis 集群不支持所有需要 "redis_url" 参数的方法。使用 Redis 集群的唯一方法是使用接受预配置 Redis 客户端的 LangChain 类，如 `RedisCache`（示例见下文）。

## 缓存

Cache包装器允许将[Redis](https://redis.io)用作远程、低延迟的内存缓存，以存储LLM提示和响应。

### 标准缓存
标准缓存是 Redis 在生产环境中为全球的 [开源](https://redis.io) 和 [企业](https://redis.com) 用户提供的核心使用案例。

```python
from langchain.cache import RedisCache
```

要将此缓存与您的 LLM 一起使用：
```python
from langchain.globals import set_llm_cache
import redis

redis_client = redis.Redis.from_url(...)
set_llm_cache(RedisCache(redis_client))
```

### 语义缓存
语义缓存允许用户根据用户输入与之前缓存结果之间的语义相似性来检索缓存的提示。其背后结合了Redis，既作为缓存又作为向量存储。

```python
from langchain.cache import RedisSemanticCache
```

要将此缓存与您的LLM一起使用：
```python
from langchain.globals import set_llm_cache
import redis

# use any embedding provider...
from tests.integration_tests.vectorstores.fake_embeddings import FakeEmbeddings

redis_url = "redis://localhost:6379"

set_llm_cache(RedisSemanticCache(
    embedding=FakeEmbeddings(),
    redis_url=redis_url
))
```

## VectorStore

vectorstore 包装器将 Redis 转变为一个低延迟的 [vector database](https://redis.com/solutions/use-cases/vector-database/) 用于语义搜索或 LLM 内容检索。

```python
from langchain_community.vectorstores import Redis
```

有关 Redis vectorstore 包装器的更详细说明，请参见 [this notebook](/docs/integrations/vectorstores/redis)。

## Retriever

Redis 向量存储检索器包装器将向量存储类进行了泛化，以执行低延迟文档检索。要创建检索器，只需在基础向量存储类上调用 `.as_retriever()`。

## 内存

Redis 可用于持久化 LLM 对话。

### 向量存储检索器记忆

有关 `VectorStoreRetrieverMemory` 包装器的更详细说明，请参见 [此笔记本](https://api.python.langchain.com/en/latest/memory/langchain.memory.vectorstore.VectorStoreRetrieverMemory.html)。

### 聊天消息历史记忆
有关使用 Redis 缓存对话消息历史的详细示例，请参阅 [此笔记本](/docs/integrations/memory/redis_chat_message_history)。